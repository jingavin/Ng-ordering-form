<main>
  <section class="p-4" style="max-width: 640px">
    <form #addrForm="ngForm" (ngSubmit)="submitAddress(addrForm)" novalidate>
      <div>
        <label>First Name</label><br />
        <input type="text" name="firstName" [(ngModel)]="firstName" required pattern="^[A-Za-z']+$"
          #firstNameCtrl="ngModel" />
        <div class="err" *ngIf="addrSubmitted && firstNameCtrl.invalid">
          <small *ngIf="firstNameCtrl.errors?.['required']">Value required.</small>
          <small *ngIf="firstNameCtrl.errors?.['pattern']">Letters and apostrophes only.</small>
        </div>
      </div>

      <div class="mt">
        <label>Last Name</label><br />
        <input type="text" name="lastName" [(ngModel)]="lastName" required pattern="^[A-Za-z']+$"
          #lastNameCtrl="ngModel" />
        <div class="err" *ngIf="addrSubmitted && lastNameCtrl.invalid">
          <small *ngIf="lastNameCtrl.errors?.['required']">Value required.</small>
          <small *ngIf="lastNameCtrl.errors?.['pattern']">Letters and apostrophes only.</small>
        </div>
      </div>

      <div class="mt">
        <label>Street Address</label><br />
        <input type="text" name="street" [(ngModel)]="street" required #streetCtrl="ngModel" />
        <div class="err" *ngIf="addrSubmitted && streetCtrl.invalid">
          <small>Street address is required.</small>
        </div>
      </div>

      <button class="mt" type="submit">Submit Address</button>
    </form>

    <p class="mt" *ngIf="addressOK">
      <span>Order for {{ firstName }} {{ lastName }} at {{ street }}.</span>
    </p>

    <hr class="mt" />

    <div class="row">
      <div>
        <label>Add Item</label><br />
        <select [(ngModel)]="selectedFruit" name="fruitSelect">
          <option value="" selected disabled>-- Select an item --</option>
          <option *ngFor="let f of fruits" [ngValue]="f">{{ f }}</option>
        </select>
      </div>

      <div class="qtyCol">
        <label>Qty</label><br />
        <input type="number" min="1" step="1" [(ngModel)]="qty" name="qtyInput" />
      </div>

      <div class="btnCol">
        <button type="button" (click)="addItem()">Add Item</button>
      </div>
    </div>

    <div class="err mt" *ngIf="addError">
      <small>{{ addError }}</small>
    </div>

    <table class="mt" *ngIf="items.length > 0" border="0" style="width:100%">
      <thead>
        <tr>
          <th style="text-align:left;">Item</th>
          <th style="text-align:right;">Qty</th>
          <th style="text-align:right;">Unit Price</th>
          <th style="text-align:right;">Amount</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let it of items; let i = index">
          <td>{{ it.name }}</td>
          <td style="text-align:right;">{{ it.qty }}</td>
          <td style="text-align:right;">{{ it.unitPrice | currency:'USD':'symbol':'1.2-2' }}</td>
          <td style="text-align:right;">{{ it.amount | currency:'USD':'symbol':'1.2-2' }}</td>
          <td>
            <a href (click)="remove(i); $event.preventDefault()">
              Delete
            </a>
          </td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="3" style="text-align:right;">Subtotal</td>
          <td style="text-align:right;">
            {{ subtotal() | currency:'USD':'symbol':'1.2-2' }}
          </td>
          <td></td>
        </tr>
        <tr>
          <td colspan="3" style="text-align:right;">Taxes 7%</td>
          <td style="text-align:right;">
            {{ tax() | currency:'USD':'symbol':'1.2-2' }}
          </td>
          <td></td>
        </tr>
        <tr>
          <td colspan="3" style="text-align:right; font-weight:600;">Total</td>
          <td style="text-align:right; font-weight:600;">
            {{ total() | currency:'USD':'symbol':'1.2-2' }}
          </td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  </section>

</main>